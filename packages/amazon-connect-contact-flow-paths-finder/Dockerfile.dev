FROM node:23-slim AS base
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"


RUN npm install -g pnpm@9.11.0
RUN pnpm add -g turbo

########################################################
# Runner stage
########################################################
FROM base AS runner
WORKDIR /app

# Copy workspace configuration files
COPY pnpm-workspace.yaml ./
COPY pnpm-lock.yaml ./
COPY package.json ./
COPY turbo.json ./
COPY .npmrc ./

# # Copy the source code to packages
# COPY packages/amazon-connect-contact-flow-paths-finder ./packages/amazon-connect-contact-flow-paths-finder

# Install dependencies (Root and all packages)
# RUN pnpm install

ENV NODE_ENV=development

EXPOSE 3000

WORKDIR /app/packages/amazon-connect-contact-flow-paths-finder

# Keep the server running
CMD ["tail", "-f", "/dev/null"]


